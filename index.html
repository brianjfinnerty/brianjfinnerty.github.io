<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8>
  <meta name=viewport content="width=device-width,initial-scale=1">
  <title>Learncube Virtual Classroom Widget</title>
  <link rel="stylesheet" type="text/css" href="https://static.learncube.net/client/virtualclassroom.css?pp">
  <script type="text/javascript" src="https://static.learncube.net/client/virtualclassroom.js?pp"></script>
 	
	
  <!--link rel="stylesheet" type="text/css" href="https://static.learncube.net/vc/virtualclassroom/apisanity/client/css/app.css?99909"-->	
  <!--script type="text/javascript" src="https://static.learncube.net/vc/virtualclassroom/apisanity/client/js/app.js?ppopp"></script-->
</head>
<body>
	<div id="app"></div>
	<script>
        const search = location.search.substring(1);
	let params;
	try {
		params = JSON.parse('{"' + decodeURI(search).replace(/"/g, '\\"').replace(/&/g, '","').replace(/=/g,'":"') + '"}')
	} catch (err) {
		params = {}
	}

	const userType = params.userType || 'student'
	const userName = 'Test ' + userType
	const token = 'local-' + (new Date()).toDateString().toLowerCase().split(' ').join('-')
	
        const lcConf = {
            'token': params.token || token, // Eg. "first-test-room-token"
            'userid': params.userId || '1234', // Eg. "12345G"
            'username': params.username || userName, // Eg. "Test Widget Teacher",	
            'publicKey': '63d2dd20e7557161942c53e4',
      	    'userType': userType,	
      	    'instantClass': true,
	    'validateUrl': 'http://localhost:3000/get-valid-token/'
        }
	const recording = false;
	const classroom = new VirtualClassroom('#app', lcConf, {
		'settings.class_control_button': true,
		'settings.show_class_feedback': false,
		'settings.allow_skip_onboarding': true,
		'settings.enter_when_admitted': false,
		'settings.enter_in_progress': false,
		// 'settings.embedded_whiteboard': true
		'video.room_recording': recording,
		'video.videoprovider': 'agora'
	});
		
	classroom.addEventListener('enterClass', function (evt) {
          if (recording) {
	    document.querySelector('.top-tips-modal-wrapper .item > p:nth-child(2)').textContent = 'Littera recordings are only for our own internal team to review to ensure quality tutoring is being delivered or in case a safety concern is reported.'
	  }
      	})

        classroom.addEventListener('exitClass', function (evt) {
          console.log('exitClassroom')
      	})

	classroom.addEventListener('updateClassStatus', function (evt) {
	    console.log('updateClassStatus', evt.detail)
	});
		
	classroom.addEventListener('enterBreakoutRoom', function (evt) {
	    const breakoutRoomToken = event.detail.token;
	    const breakoutRoomUser = event.detail.userid;
	    const breakoutRoom = `https://brianjfinnerty.github.io/index.html?userId=${params.userId}&token=${breakoutRoomToken}&userType=${userType}&username=${params.username}`
	    window.location = breakoutRoom
	});	
	
	classroom.addEventListener('whiteboardAction', function (evt) {
          console.log('whiteboardAction', evt.detail)
      	});	
	
	classroom.addEventListener('apiConfigError', function (evt) {
          console.log('apiConfigError', evt)
      	})
	</script>

   

</body>
</html>
